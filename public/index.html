<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Diabetes prediction application using machine learning to assess diabetes risk based on health metrics">
    <title>Diabetes Prediction System</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Diabetes Prediction System</h1>
        <p>Enter your health data to predict diabetes risk</p>
        
        <div class="error-message" id="error-message" style="display: none;">
            <p id="error-text"></p>
        </div>
        
        <form id="prediction-form">
            <div class="input-group">
                <label for="pregnancies">Pregnancies</label>
                <input type="number" id="pregnancies" name="pregnancies" required min="0" max="20" step="1" value="0">
                <span class="info">Number of pregnancies</span>
            </div>
            
            <div class="input-group">
                <label for="glucose">Glucose Level</label>
                <input type="number" id="glucose" name="glucose" required min="0" max="300" value="100">
                <span class="info">Plasma glucose concentration (mg/dL)</span>
            </div>
            
            <div class="input-group">
                <label for="blood_pressure">Blood Pressure</label>
                <input type="number" id="blood_pressure" name="blood_pressure" required min="0" max="200" value="70">
                <span class="info">Diastolic blood pressure (mm Hg)</span>
            </div>
            
            <div class="input-group">
                <label for="skin_thickness">Skin Thickness</label>
                <input type="number" id="skin_thickness" name="skin_thickness" required min="0" max="100" value="20">
                <span class="info">Triceps skinfold thickness (mm)</span>
            </div>
            
            <div class="input-group">
                <label for="insulin">Insulin Level</label>
                <input type="number" id="insulin" name="insulin" required min="0" max="900" value="80">
                <span class="info">2-Hour serum insulin (mu U/ml)</span>
            </div>
            
            <div class="input-group">
                <label for="bmi">BMI</label>
                <input type="number" id="bmi" name="bmi" required min="10" max="70" step="0.1" value="25.0">
                <span class="info">Body mass index (weight in kg/(height in m)Â²)</span>
            </div>
            
            <div class="input-group">
                <label for="diabetes_pedigree">Diabetes Pedigree Function</label>
                <input type="number" id="diabetes_pedigree" name="diabetes_pedigree" required min="0" max="3" step="0.01" value="0.5">
                <span class="info">Diabetes pedigree function (genetic influence)</span>
            </div>
            
            <div class="input-group">
                <label for="age">Age</label>
                <input type="number" id="age" name="age" required min="0" max="120" step="1" value="30">
                <span class="info">Age in years</span>
            </div>
            
            <button type="submit" class="predict-btn">Predict</button>
        </form>
    </div>

    <script>
        // Wait for the page to load
        document.addEventListener('DOMContentLoaded', function() {
            // Get the form element
            const form = document.getElementById('prediction-form');
            
            // Add submit event listener
            form.addEventListener('submit', async function(event) {
                // Prevent the default form submission
                event.preventDefault();
                
                try {
                    // Show loading message
                    showLoading();
                    
                    // Get form values
                    const pregnancies = parseFloat(document.getElementById('pregnancies').value);
                    const glucose = parseFloat(document.getElementById('glucose').value);
                    const bloodPressure = parseFloat(document.getElementById('blood_pressure').value);
                    const skinThickness = parseFloat(document.getElementById('skin_thickness').value);
                    const insulin = parseFloat(document.getElementById('insulin').value);
                    const bmi = parseFloat(document.getElementById('bmi').value);
                    const diabetesPedigree = parseFloat(document.getElementById('diabetes_pedigree').value);
                    const age = parseFloat(document.getElementById('age').value);
                    
                    // Create form data object for API call
                    const formData = {
                        pregnancies,
                        glucose,
                        blood_pressure: bloodPressure,
                        skin_thickness: skinThickness,
                        insulin,
                        bmi,
                        diabetes_pedigree: diabetesPedigree,
                        age
                    };
                    
                    // Make API call to the Python serverless function
                    const response = await fetch('/.netlify/functions/predict', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    // Parse the response
                    const result = await response.json();
                    
                    // Hide loading message
                    hideLoading();
                    
                    // Show result
                    showResult(result);
                } catch (error) {
                    // Hide loading message
                    hideLoading();
                    
                    // Show error message
                    showError('Error: ' + error.message);
                }
            });
            
            // Function to show error message
            function showError(message) {
                const errorElement = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                errorText.textContent = message;
                errorElement.style.display = 'block';
            }
            
            // Function to show loading message
            function showLoading() {
                const loadingElement = document.createElement('div');
                loadingElement.id = 'loading-message';
                loadingElement.className = 'loading-message';
                loadingElement.innerHTML = '<p>Processing your prediction...</p>';
                document.querySelector('.container').appendChild(loadingElement);
            }
            
            // Function to hide loading message
            function hideLoading() {
                const loadingElement = document.getElementById('loading-message');
                if (loadingElement) {
                    loadingElement.remove();
                }
            }
            
            // No longer need the client-side prediction function as we're using the Python model
            
            // Function to show the result
            function showResult(result) {
                // Create a result container
                const resultContainer = document.createElement('div');
                resultContainer.className = 'result-view';
                resultContainer.innerHTML = `
                    <div class="container">
                        <h1>Diabetes Prediction Result</h1>
                        
                        <div class="result-container ${result.prediction === 'Positive' ? 'positive' : 'negative'}">
                            <h2>Prediction: <span>${result.prediction}</span></h2>
                            <p class="probability">Probability: <span>${result.probability}%</span></p>
                        </div>
                        
                        <div class="features-summary">
                            <h3>Input Features:</h3>
                            <table>
                                <tr>
                                    <th>Feature</th>
                                    <th>Value</th>
                                </tr>
                                ${Object.entries(result.features).map(([feature, value]) => 
                                    `<tr><td>${feature}</td><td>${value}</td></tr>`
                                ).join('')}
                            </table>
                        </div>
                        
                        <div class="disclaimer">
                            <p><strong>Note:</strong> This prediction is based on a machine learning model and should not be considered as a medical diagnosis. Please consult with a healthcare professional for proper medical advice.</p>
                        </div>
                        
                        <button class="back-btn" id="back-button">Make Another Prediction</button>
                    </div>
                `;
                
                // Clear the current content
                document.querySelector('.container').innerHTML = '';
                
                // Add the result to the page
                document.querySelector('.container').appendChild(resultContainer);
                
                // Add event listener to the back button
                document.getElementById('back-button').addEventListener('click', function() {
                    window.location.reload();
                });
            }
        });
    </script>
</body>
</html>
